<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="author" content="Boris Vassilev">
  <title>Lir Tutorial: Finding Anagrams</title>
  <style type="text/css">code{white-space: pre;}</style>
  <link href="data:text/css;charset=utf-8,p%20%7B%0Amax%2Dwidth%3A%2014cm%3B%0A%7D%0Ablockquote%20%7B%0Amax%2Dwidth%3A%2011cm%3B%0Afont%2Dsize%3A%20small%3B%0A%7D%0Aul%2C%20ol%2C%20dl%2C%0Aspan%2Echunkdefs%20%7B%0Amax%2Dwidth%3A%2012cm%3B%0A%7D%0Abody%20%7B%0Apadding%2Dleft%3A%201cm%3B%0A%7D%0Ah1%2C%20h2%2C%20h3%20%7B%0Afont%2Dfamily%3A%20sans%2Dserif%3B%0Amax%2Dwidth%3A%2012cm%3B%0A%7D%0Aspan%2Equote%20%7B%0Afont%2Dfamily%3A%20monospace%3B%0A%7D%0Aspan%2Esourcefile%20a%2C%0Aspan%2Eresultfile%20a%2C%0Aspan%2Elistingfile%20a%2C%0Aspan%2Efigurefile%20a%2C%0Aspan%2Echunkdefs%20a%2C%0Aspan%2Echunkuses%20a%2C%0Aspan%2Echunkprev%20a%2C%0Aspan%2Echunknext%20a%2C%0Aspan%2Edefn%20a%2C%0Aspan%2Equoteduse%20a%2C%0Aspan%2Eembeddeduse%20a%20%7B%0Atext%2Ddecoration%2Dline%3A%20none%3B%0A%7D%0Aspan%2Echunkdefs%2C%0Aspan%2Echunkuses%2C%0Aspan%2Echunkprev%2C%0Aspan%2Echunknext%20%7B%0Afont%2Dsize%3A%20small%3B%0A%7D%0Aspan%2Equoteduse%20%7B%0Afont%2Dfamily%3A%20serif%3B%0A%7D%0Aspan%2Eembeddeduse%20%7B%0Afont%2Dfamily%3A%20serif%3B%0A%7D%0Aspan%2Echunknr%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aspan%2Equoteduse%20a%20%7B%0Acolor%3A%20darkGreen%3B%0A%7D%0Aspan%2Equoteduse%20a%3Ahover%20%7B%0Acolor%3A%20limeGreen%3B%0A%7D%0Aspan%2Eembeddeduse%20a%20%7B%0Acolor%3A%20darkblue%3B%0Afont%2Dstyle%3A%20italic%3B%0A%7D%0Aspan%2Eembeddedusesym%20%7B%0Afont%2Dstyle%3A%20normal%3B%0A%7D%0Aspan%2Eembeddeduse%20a%3Ahover%20%7B%0Acolor%3A%20dodgerBlue%3B%0A%7D%0Aspan%2Esourcefile%20a%2C%0Aspan%2Eresultfile%20a%2C%0Aspan%2Elistingfile%20a%2C%0Aspan%2Efigurefile%20a%2C%0Aspan%2Echunkdefs%20a%2C%0Aspan%2Echunkprev%20a%2C%0Aspan%2Echunknext%20a%2C%0Aspan%2Edefn%20a%2C%0Aspan%2Echunkuses%20a%20%7B%0Acolor%3A%20darkred%3B%0A%7D%0Aspan%2Esourcefile%20a%3Ahover%2C%0Aspan%2Eresultfile%20a%3Ahover%2C%0Aspan%2Elistingfile%20a%3Ahover%2C%0Aspan%2Efigurefile%20a%3Ahover%2C%0Aspan%2Echunkdefs%20a%3Ahover%2C%0Aspan%2Echunkprev%20a%3Ahover%2C%0Aspan%2Echunknext%20a%3Ahover%2C%0Aspan%2Edefn%20a%3Ahover%2C%0Aspan%2Echunkuses%20a%3Ahover%20%7B%0Acolor%3A%20darkGoldenRod%3B%0A%7D%0Aul%2Echunkslist%20%7B%0Alist%2Dstyle%2Dtype%3A%20square%3B%0A%7D%0Adiv%2Elirtable%20th%20%7B%0Aborder%2Dstyle%3A%20none%20none%20solid%20none%3B%0Aborder%2Dwidth%3A%200%200%201px%200%3B%0A%7D%0Adiv%2Elirtable%20th%2C%0Adiv%2Elirtable%20td%20%7B%0Apadding%2Dleft%3A%203%2E3mm%3B%0Apadding%2Dright%3A%203%2E3mm%3B%0Apadding%2Dtop%3A%200%2E9mm%3B%0Apadding%2Dbottom%3A%200%2E9mm%3B%0A%7D%0Adiv%2Elirtable%20table%20%7B%0Afont%2Dfamily%3A%20sans%2Dserif%3B%0Afont%2Dsize%3A%20small%3B%0Amargin%2Dtop%3A%203mm%3B%0Amargin%2Dbottom%3A%203mm%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0Aborder%2Dstyle%3A%20solid%20none%20solid%20none%3B%0Aborder%2Dwidth%3A%202px%200%201px%200%3B%0A%7D%0Adiv%2Elirlisting%20%7B%0Amax%2Dwidth%3A%2014cm%3B%0A%7D%0Aspan%2Esourcename%2C%0Aspan%2Eresultname%2C%0Aspan%2Etablename%2C%0Aspan%2Efigurename%2C%0Aspan%2Elistingname%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Adiv%2Efigurecontents%20img%20%7B%0Adisplay%3A%20block%3B%0Amax%2Dwidth%3A%2014cm%3B%0Awidth%3A%20auto%3B%0Aheight%3A%20auto%3B%0A%7D%0Adiv%2Elistingcontents%20%7B%0Afont%2Dsize%3A%20small%3B%0Amargin%2Dtop%3A%203mm%3B%0Amargin%2Dbottom%3A%203mm%3B%0Aborder%2Dstyle%3A%20solid%20none%20solid%20none%3B%0Aborder%2Dwidth%3A%200%2E3mm%3B%0A%7D%0Aspan%2Esourcefile%2C%0Aspan%2Eresultfile%2C%0Aspan%2Etablefile%2C%0Aspan%2Efigurefile%2C%0Aspan%2Elistingfile%20%7B%0Afont%2Dstyle%3A%20italic%3B%0A%7D%0Adiv%2Etablemeta%2C%0Adiv%2Efiguremeta%2C%0Adiv%2Elistingmeta%20%7B%0Amax%2Dwidth%3A%2014cm%3B%0Afont%2Dsize%3A%20small%3B%0A%7D%0Aspan%2Etabletitle%2C%0Aspan%2Efiguretitle%2C%0Aspan%2Elistingtitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Adiv%2Ecodechunk%2C%0Adiv%2Elirlisting%2C%0Adiv%2Elirtable%2C%0Adiv%2Elirfigure%20%7B%0Amargin%2Dbottom%3A%203mm%3B%0A%7D%0A" rel="stylesheet">
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header>
<h1 class="title">Lir Tutorial: Finding Anagrams</h1>
<h2 class="author">Boris Vassilev</h2>
</header>
<nav id="TOC">
<ul>
<li><a href="#document-formatting-and-structure">Document formatting and structure</a><ul>
<li><a href="#sections-and-subsections">Sections and subsections</a></li>
<li><a href="#links">Links</a></li>
</ul></li>
<li><a href="#making-the-final-document">Making the final document</a></li>
<li><a href="#aim">Aim</a></li>
<li><a href="#dictionary">Dictionary</a></li>
<li><a href="#recap">Recap</a></li>
<li><a href="#bibliography">Bibliography</a></li>
</ul>
</nav>
<p><strong>Welcome to the Lir Tutorial</strong></p>
<p>To make best use of this tutorial, open this source file in a text editor and start reading. Every time you see a “<code>----</code>” on a line by itself, it is a good time to stop reading for a moment and try to compile the source file up to that point. This can be done by simply invoking <code>lir</code> with the file as its only argument:</p>
<pre><code>$ lir anagrams.lir</code></pre>
<p>If everything goes well, a final document, <code>anagrams.html</code>, will be generated in your working directory. Open it in your web browser!</p>
<p>The file up to here is just a plain text file, formatted using the “markdown” markup recognized by Pandoc. The whole first line is surrounded by double asterisk (<code>**</code>) for strong emphasis. In the first paragraph, there is inline code surrounded by single backticks (<code>`</code>). We see a single-line block of source code verbatim; usually, this is not necessary in a Lir source file.</p>
<p>Now let’s try to generate the first version of the final document:</p>
<ul>
<li>You can copy everything up to (and including) the 4-dash line below to file named <code>anagrams.lir</code> in your working directory.</li>
<li>You can also use the link below to download this file.</li>
<li>For <code>git</code> users: you can use the version of <code>anagrams.lir</code> in this repository in the tag <code>tag-01</code>.</li>
</ul>
<p>Now, run Lir. Notice how the list above was correctly recognized and typeset differently.</p>
<p>Get <a href="/lir-tutorial/docs/1/anagrams.lir">source</a>and <a href="https://borisvassilev.github.io/lir-tutorial/1/anagrams.html">final document</a></p>
<hr />
<h1 id="document-formatting-and-structure">Document formatting and structure</h1>
<p>The previous part contains a few examples of using markdown to format your text. In this part, we will see more uses of markdown. At the beginning of this paragraph, there is a line starting with a hash sign (<code>#</code>). This defines a section heading: in the final document, “Document formatting and structure” will be typeset differently, and it will appear in a table of contents at the beginning of the document.</p>
<p>First, let’s give our data analysis an aim and a name. We want to find anagrams of words in the English language. We will call the data analysis “Anagrams”, and give our name as an author.</p>
<p>(This will not appear in the final document at that spot: it will be used to create the document title.)</p>
<h2 id="sections-and-subsections">Sections and subsections</h2>
<p>By using 1, 2, or 3 hash signs at the beginning of the line, we define sections, subsections, subsubsections in the final document.</p>
<h2 id="links">Links</h2>
<p>Here is a <a href="http://pandoc.org/MANUAL.html">link to the Pandoc User’s Guide</a>. I usually need to keep this guide open while I’m writing a Lir source file.</p>
<h1 id="making-the-final-document">Making the final document</h1>
<p>In order to be able to use Lir efficiently, you need to learn at least a bit about the program Make and the syntax of Makefiles. Here, we will define a Makefile for our data analysis.</p>
<pre><code>name = anagrams

all: $(name).html

$(name).html: $(name).lir
	lir $(name).lir
</code></pre>
<p>This can go into a file called <code>Makefile</code> in the working directory for this data analysis. It does very little: tells make that to make all files, it needs to generate the file <code>anagrams.html</code> by running the program <code>lir</code> with <code>anagrams.lir</code> as its first and only argument. Save this to <code>Makefile</code> and run <code>make</code> (no arguments necessary) from the working directory.</p>
<p>Get <a href="/lir-tutorial/docs/2/anagrams.lir">source</a>and <a href="https://borisvassilev.github.io/lir-tutorial/2/anagrams.html">final document</a></p>
<hr />
<h1 id="aim">Aim</h1>
<p>The aim of this tutorial is to show you how to use Lir efficiently and effectively. To achieve this, the tutorial describes the solution to a simple problem: how to find anagrams in the English language.</p>
<p>The idea is to follow the solution outlined by Bentley in “Programming Pearls” <span class="citation" data-cites="bentley1986programming">(Bentley 1986)</span>. We are going to prepare a dictionary of words, calculate the signature of each word, sort by signatures. At that point, all sets of words that are anagrams of each other will be in consecutive runs, signed by the same signature. We will squash them, each set (with more than two words in it) displayed on a space-separated line.</p>
<p>Now, we are going to define our first special code chunk. If the name of the code chunk is prefixed by “<code>source:</code>”, this declares the name of a file that is necessary in order to generate the final document. Here, we need to declare that we are using the file <code>anagrams.bib</code>, which contains the bibliography for this document. In the previous paragraph, we have cited the 1986 book “Programming Pearls” using the “<code>[@&lt;bibkey&gt;]</code>” markdown.</p>
<div id="NW0-3goU2e-1" class="lirdisplay">
<div class="lirsource">
<span class="sourcename">S1:</span> <span class="sourcefile"><a href="/home/boris/code/lir-tutorial/.lir/anagrams.bib"><code>anagrams.bib</code></a></span>
</div>
</div>
<p>This first code chunk that we have declared does not have any contents.</p>
<p>From now on, the document will end with the beginning of a last section, “Bibliography”.</p>
<p>Get <a href="/lir-tutorial/docs/3/anagrams.lir">source</a>and <a href="https://borisvassilev.github.io/lir-tutorial/3/anagrams.html">final document</a></p>
<hr />
<h1 id="dictionary">Dictionary</h1>
<p>What is a dictionary that is useful as input to our program? What exactly is the program going to do? We want to find a signature for every word in the dictionary. To do that, we will sort the characters of each word. If a two different words have the same signature, this means they have the exact same letters, so, they are anagrams of each other.</p>
<p>I will use <a href="/usr/share/dict/words">the dictionary available with the Linux distribution</a>. This file was copied to the working directory under the name <code>en-dict</code>, and declared as an input file (source).</p>
<div id="NW0-1y56Hy-1" class="lirdisplay">
<div class="lirsource">
<span class="sourcename">S2:</span> <span class="sourcefile"><a href="/home/boris/code/lir-tutorial/.lir/en-dict"><code>en-dict</code></a></span>
</div>
</div>
<p>This dictionary is meant to be used by other programs, for example to check spelling. It contains duplicate version of many words, only with the first letter capitalized or suffixed by an “’s”. To get rid of these duplicates, we define a bash script. It contains three components in a pipe:</p>
<div class="codechunk">
<p><span id="NW0-1pYc1X-1" class="defn"><span class="chunknr">C1:</span> ⟪<span style="white-space:nowrap"> </span><a href="#NW0-1pYc1X-1">clean-en-dict.sh</a><span style="white-space:nowrap"> </span>⟫<span style="white-space:nowrap"> </span>≡</span><span class="chunkuses"><br> root chunk</span></p>
<pre>
<span class="embeddeduse">⟪<span style="white-space:nowrap"> </span><a id="NW0-1pYc1X-1-u1" href="#NW0-46TBz6-1">Set all letters to lower case</a><span style="white-space:nowrap"> </span>⟫</span> \
        | <span class="embeddeduse">⟪<span style="white-space:nowrap"> </span><a id="NW0-1pYc1X-1-u2" href="#NW0-4UzD4N-1">Delete 's at the end of words</a><span style="white-space:nowrap"> </span>⟫</span> \
        | <span class="embeddeduse">⟪<span style="white-space:nowrap"> </span><a id="NW0-1pYc1X-1-u3" href="#NW0-3HloOv-1">Sort, leaving only unique entries</a><span style="white-space:nowrap"> </span>⟫</span>
</pre>
◼
</div>
<p>The first “normal” code chunk <span class="quote"><span class="quoteduse">⟪<span style="white-space:nowrap"> </span><a href="#NW0-1pYc1X-1">clean-en-dict.sh</a><span style="white-space:nowrap"> </span>⟫</span></span> is used to define the pipe that cleans the dictionary file. It is a root chunk: it is not referenced by name in any other code chunk. It contains references to other code chunks by name.</p>
<p>The first chunk referenced above is <span class="quote"><span class="quoteduse">⟪<span style="white-space:nowrap"> </span><a href="#NW0-46TBz6-1">Set all letters to lower case</a><span style="white-space:nowrap"> </span>⟫</span></span>. It is a call to a SWI-Prolog script that converts all letters to lower case.</p>
<div class="codechunk">
<p><span id="NW0-46TBz6-1" class="defn"><span class="chunknr">C2:</span> ⟪<span style="white-space:nowrap"> </span><a href="#NW0-46TBz6-1">Set all letters to lower case</a><span style="white-space:nowrap"> </span>⟫<span style="white-space:nowrap"> </span>≡</span><span class="chunkuses"><br> Appears in <a href="#NW0-1pYc1X-1">C1</a></span></p>
<pre>
<span class="embeddeduse">⟪<span style="white-space:nowrap"> </span><a id="NW0-46TBz6-1-u1" href="#NW0-40OfWs-1">Run SWI-Prolog script</a><span style="white-space:nowrap"> </span>⟫</span> to-lower-case.prolog
</pre>
◼
</div>
<p>The script <span class="quote"><span class="quoteduse">⟪<span style="white-space:nowrap"> </span><a href="#NW0-2p6ucA-1">to-lower-case.prolog</a><span style="white-space:nowrap"> </span>⟫</span></span> has to be declared as a dependency of the Bash script that uses it:</p>
<div class="codechunk">
<p><span id="NW0-3dMVig-1" class="defn"><span class="chunknr">C3:</span> ⟪<span style="white-space:nowrap"> </span><a href="#NW0-3dMVig-1">:make</a><span style="white-space:nowrap"> </span>⟫<span style="white-space:nowrap"> </span>≡</span><span class="chunkuses"><br> root chunk</span><span class="chunkdefs"><br> definition continued in <a href="#NW0-3dMVig-2">↓<span style="white-space:nowrap"> </span>C8</a> + <a href="#NW0-3dMVig-3">⇣<span style="white-space:nowrap"> </span>C9</a></span></p>
<pre>
clean-en-dict.sh: to-lower-case.prolog

</pre>
<span class="chunknext"><a href="#NW0-3dMVig-2">⇩<span style="white-space:nowrap"> </span>C8</a></span>
</div>
<p>The SWI-Prolog script reads all input, converts it to lower case, and writes it to output.</p>
<div class="codechunk">
<p><span id="NW0-2p6ucA-1" class="defn"><span class="chunknr">C4:</span> ⟪<span style="white-space:nowrap"> </span><a href="#NW0-2p6ucA-1">to-lower-case.prolog</a><span style="white-space:nowrap"> </span>⟫<span style="white-space:nowrap"> </span>≡</span><span class="chunkuses"><br> root chunk</span></p>
<pre>
main :-
        read_string(current_input, _, Input),
        string_lower(Input, Output),
        format(current_output, &quot;~s&quot;, [Output]).
</pre>
◼
</div>
<p>To safely run this and any Prolog program that defines a <code>main</code>, we can do:</p>
<div class="codechunk">
<p><span id="NW0-40OfWs-1" class="defn"><span class="chunknr">C5:</span> ⟪<span style="white-space:nowrap"> </span><a href="#NW0-40OfWs-1">Run SWI-Prolog script</a><span style="white-space:nowrap"> </span>⟫<span style="white-space:nowrap"> </span>≡</span><span class="chunkuses"><br> Appears in <a href="#NW0-46TBz6-1">C2</a></span></p>
<pre>
swipl -q -O -g 'main,halt' -t 'halt(1)'
</pre>
◼
</div>
<p>In the next component of the pipeline, a call to <code>sed</code> removes all trailing “’s”.</p>
<div class="codechunk">
<p><span id="NW0-4UzD4N-1" class="defn"><span class="chunknr">C6:</span> ⟪<span style="white-space:nowrap"> </span><a href="#NW0-4UzD4N-1">Delete ’s at the end of words</a><span style="white-space:nowrap"> </span>⟫<span style="white-space:nowrap"> </span>≡</span><span class="chunkuses"><br> Appears in <a href="#NW0-1pYc1X-1">C1</a></span></p>
<pre>
sed &quot;s/'s$//&quot;
</pre>
◼
</div>
<p>At the end, everything is sorted, leaving only unique entries.</p>
<div class="codechunk">
<p><span id="NW0-3HloOv-1" class="defn"><span class="chunknr">C7:</span> ⟪<span style="white-space:nowrap"> </span><a href="#NW0-3HloOv-1">Sort, leaving only unique entries</a><span style="white-space:nowrap"> </span>⟫<span style="white-space:nowrap"> </span>≡</span><span class="chunkuses"><br> Appears in <a href="#NW0-1pYc1X-1">C1</a></span></p>
<pre>
sort --unique
</pre>
◼
</div>
<p>We define the transformation from the original file <code>en-dict</code> to the cleaned <code>en-words</code> as another rule:</p>
<div class="codechunk">
<p><span id="NW0-3dMVig-2" class="defn"><span class="chunknr">C8:</span> ⟪<span style="white-space:nowrap"> </span><a href="#NW0-3dMVig-2">:make</a><span style="white-space:nowrap"> </span>⟫<span style="white-space:nowrap"> </span>≡</span><br> <span class="chunkprev"><a href="#NW0-3dMVig-1">⇧<span style="white-space:nowrap"> </span>C3</a></span></p>
<pre>
en-words: en-dict clean-en-dict.sh
	bash clean-en-dict.sh &lt; $&lt; &gt; $@

</pre>
<span class="chunknext"><a href="#NW0-3dMVig-3">⇩<span style="white-space:nowrap"> </span>C9</a></span>
</div>
<p>The first line of this rule reads:</p>
<blockquote>
<p>To generate the file <code>en-words</code>, you need the files <code>en-dict</code> and <code>clean-en-dict.sh</code>.</p>
</blockquote>
<p>The second line of the rule reads:</p>
<blockquote>
<p>Run the bash script <code>clean-en-dict.sh</code> to convert the first prerequisite <code>en-dict</code> (written as <code>$&lt;</code>) to create the target <code>en-words</code> (written as <code>$@</code>).</p>
</blockquote>
<p>There is an empty line after the second line: it is necessary in order to finish the rule.</p>
<p>Finally, to have a vague idea if this all worked, we can add a display item with the sizes of the original and the cleaned dictionary. Immediately below the placeholder for the listing is the rule for generating the result using <code>wc</code>.</p>
<div id="NW0-1Kvowe-1" class="lirdisplay">
<div class="lirlisting">
<div class="listingheader">
<span class="listingname">Listing 1:</span> <span class="listingfile"><a href="/home/boris/code/lir-tutorial/.lir/en-sizes"><code>en-sizes</code></a></span>
</div>
<div class="listingcontents">
<pre>
  86862 en-words
 119095 en-dict
 205957 total
</pre>
</div>
<div class="listingmeta">
<span class="listingtitle">Word file sizes.</span>
</div>
</div>
</div>
<div class="codechunk">
<p><span id="NW0-3dMVig-3" class="defn"><span class="chunknr">C9:</span> ⟪<span style="white-space:nowrap"> </span><a href="#NW0-3dMVig-3">:make</a><span style="white-space:nowrap"> </span>⟫<span style="white-space:nowrap"> </span>≡</span><br> <span class="chunkprev"><a href="#NW0-3dMVig-2">⇧<span style="white-space:nowrap"> </span>C8</a></span></p>
<pre>
en-sizes: en-words en-dict
	wc --lines $^ &gt; $@

</pre>
◼
</div>
<p>Get <a href="/lir-tutorial/docs/4/anagrams.lir">source</a>and <a href="https://borisvassilev.github.io/lir-tutorial/4/anagrams.html">final document</a></p>
<hr />
<h1 id="recap">Recap</h1>
<p>The last part was quite a long one, with a lot of new concepts. Now is a good moment to stop and summarize everything we have done so far.</p>
<ul>
<li>Defined a valid Lir source file;</li>
<li>Formatted and structured the file using markdown;</li>
<li>Declared input data files (sources);</li>
<li>Defined a Bash program and an SWI-Prolog program;</li>
<li>Declared rules for file dependencies and for executing programs;</li>
<li>Inserted a listing of a result file to a display item in the final document.</li>
<li>Along the way, generated the final document for every version of the Lir source file.</li>
</ul>
<p>Get <a href="/lir-tutorial/docs/5/anagrams.lir">source</a>and <a href="https://borisvassilev.github.io/lir-tutorial/5/anagrams.html">final document</a></p>
<hr />
<h1 id="bibliography" class="unnumbered">Bibliography</h1>
<div id="refs" class="references">
<div id="ref-bentley1986programming">
<p>Bentley, Jon. 1986. <em>Programming Pearls</em>. ACM.</p>
</div>
</div>
</body>
</html>
